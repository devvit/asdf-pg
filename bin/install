#!/usr/bin/env bash

install() {
  version=$2
  install_dir=$3

  build_dir=$(mktemp -d)
  cd $build_dir

  curl -fSL -JO https://github.com/postgres/postgres/archive/$version.tar.gz
  tar -xzf postgres*.gz
  rm -rf postgres*.gz
  cd postgres*
  ./configure --with-uuid=e2fs --prefix=$ASDF_INSTALL_PATH
  make -s install-world || exit 1

  git clone https://github.com/markokr/pghashlib
  cd pghashlib
  make install || exit 1
}

install $ASDF_INSTALL_TYPE $ASDF_INSTALL_VERSION $ASDF_INSTALL_PATH
